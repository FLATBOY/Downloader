name: Keep Render App Alive

on: 
  schedule:
    - cron: '*/5 * * * *' # run every 5 minutes
  
jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
    - name: Send ping to Render App
    id: ping
    run: |
      curl -s --max-time 5 https://video-download-o0wf.onrender.com || echo "::set-output name=status::fail"

    - name: Send Telegram alert if failed
    if: steps.ping.outputs.status == 'fail'
    env:
      TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
      TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
    run: |
      curl -s -X POST https://api.telegram.org/bot$TELEGRAM_TOKEN/sendMessage \
      -d chat_id=$TELEGRAM_CHAT_ID \
      -d text="Render app is not responding"
